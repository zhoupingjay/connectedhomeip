<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Connected Home over IP: Build Documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.svg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Connected Home over IP
   &#160;<span id="projectnumber">d8a2d1f</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md__home_runner_work_connectedhomeip_connectedhomeip_docs__b_u_i_l_d_i_n_g.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Build Documentation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>CHIP supports configuring the build with <a href="https://gn.googlesource.com/gn/">GN</a>, a fast and scalable meta-build system that generates inputs to <a href="https://ninja-build.org/">ninja</a>.</p>
<p>Tested on:</p>
<ul>
<li>macOS 10.15</li>
<li>Debian 10</li>
<li>Ubuntu 20.04 LTS</li>
</ul>
<p>Build system features:</p>
<ul>
<li>Very fast and small footprint</li>
<li>Cross-platform handling: (Linux, Darwin, embedded arm, etc.)</li>
<li>Multiple toolchains &amp; cross toolchain dependencies</li>
<li>Integrates automated testing framework: <code>ninja check</code></li>
<li>Introspection: <code>gn desc</code></li>
<li>Automatic formatting: <code>gn format</code></li>
</ul>
<h2><a class="anchor" id="autotoc_md40"></a>
Checking out the Code</h2>
<p>To check out the CHIP repostiory:</p>
<div class="fragment"><div class="line">git clone --recurse-submodules git@github.com:project-chip/connectedhomeip.git</div>
</div><!-- fragment --><p>If you already have a checkout, run the following command to sync submodules:</p>
<div class="fragment"><div class="line">git submodule update --init</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md41"></a>
Prerequisites</h2>
<p>Before building, you'll need to install a few OS specific dependencies.</p>
<h3><a class="anchor" id="autotoc_md42"></a>
How to install prerequisites on Linux</h3>
<p>On Debian-based Linux distributions such as Ubuntu, these dependencies can be satisfied with the following:</p>
<div class="fragment"><div class="line">sudo apt-get install git gcc g++ python pkg-config libssl-dev libdbus-1-dev libglib2.0-dev libavahi-client-dev ninja-build python3-venv python3-dev unzip</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md43"></a>
How to install prerequisites on macOS</h3>
<p>On macOS, first install Xcode from the Mac App Store. The remaining dependencies can be installed and satisfied using <a href="https://brew.sh/">Brew</a>:</p>
<div class="fragment"><div class="line">brew install openssl pkg-config</div>
</div><!-- fragment --><p>However, that does not expose the package to <code>pkg-config</code>. To fix that, one needs to run something like the following:</p>
<div class="fragment"><div class="line">cd /usr/local/lib/pkgconfig</div>
<div class="line">ln -s ../../Cellar/openssl@1.1/1.1.1g/lib/pkgconfig/* .</div>
</div><!-- fragment --><p>where <code>openssl@1.1/1.1.1g</code> may need to be replaced with the actual version of OpenSSL installed by Brew.</p>
<p>Note: If using MacPorts, <code>port install openssl</code> is sufficient to satisfy this dependency.</p>
<h3><a class="anchor" id="autotoc_md44"></a>
How to install prerequisites on Raspberry Pi 4</h3>
<p>Using <code>rpi-imager</code>, install the Ubuntu <em>20.10</em> LTS 64-bit <em>server</em> OS for arm64 architectures on a micro SD card. This release will have bluez 5.55 which is required for BLE functionality.</p>
<p>Boot the SD card, login with the default user account "ubuntu" and password "ubuntu", then proceed with "How to install prerequisites on Linux".</p>
<p>Finally, install some Raspberry Pi specific dependencies:</p>
<div class="fragment"><div class="line">sudo apt-get install pi-bluetooth</div>
</div><!-- fragment --><p>You need to reboot your RPi after install <code>pi-bluetooth</code>.</p>
<h2><a class="anchor" id="autotoc_md45"></a>
Build Preparation</h2>
<p>Before running any other build command, the <code>scripts/activate.sh</code> environment setup script should be sourced at the top level. This script takes care of downloading GN, ninja, and setting up a Python environment with libraries used to build and test.</p>
<div class="fragment"><div class="line">source scripts/activate.sh</div>
</div><!-- fragment --><p>If this script says the environment is out of date, it can be updated by running:</p>
<div class="fragment"><div class="line">source scripts/bootstrap.sh</div>
</div><!-- fragment --><p>The <code>scripts/bootstrap.sh</code> script re-creates the environment from scratch, which is expensive, so avoid running it unless the environment is out of date.</p>
<h2><a class="anchor" id="autotoc_md46"></a>
Build for the Host OS (Linux or macOS)</h2>
<p>This will build all sources, libraries, and tests for the host platform:</p>
<div class="fragment"><div class="line">source scripts/activate.sh</div>
<div class="line"> </div>
<div class="line">gn gen out/host</div>
<div class="line"> </div>
<div class="line">ninja -C out/host</div>
</div><!-- fragment --><p>This generates a configuration suitable for debugging. To configure an optimized build, specify <code>is_debug=false</code>:</p>
<div class="fragment"><div class="line">gn gen out/host --args=&#39;is_debug=false&#39;</div>
<div class="line"> </div>
<div class="line">ninja -C out/host</div>
</div><!-- fragment --><p>The directory name <code>out/host</code> can be any directory, although it's conventional to build within the <code>out</code> directory. This example uses <code>host</code> to emphasize that we're building for the host system. Different build directories can be used for different configurations, or a single directory can be used and reconfigured as necessary via <code>gn args</code>.</p>
<p>To run all tests, run:</p>
<div class="fragment"><div class="line">ninja -C out/host check</div>
</div><!-- fragment --><p>To run only the tests in src/inet/tests, you can run:</p>
<div class="fragment"><div class="line">ninja -C out/host src/inet/tests:tests_run</div>
</div><!-- fragment --><p>Note that the build system caches passing tests, so if you see</p>
<div class="fragment"><div class="line">ninja: no work to do</div>
</div><!-- fragment --><p>that means that the tests passed in a previous build.</p>
<h2><a class="anchor" id="autotoc_md47"></a>
Build Custom configuration</h2>
<p>The build is configured by setting build arguments. These are set by passing the <code>--args</code> option to <code>gn gen</code>, by running <code>gn args</code> on the output directory, or by hand editing <code>args.gn</code> in the output directory. To configure a new build or edit the arguments to existing build, run:</p>
<div class="fragment"><div class="line">source scripts/activate.sh</div>
<div class="line"> </div>
<div class="line">gn args out/custom</div>
<div class="line"> </div>
<div class="line">ninja -C out/custom</div>
</div><!-- fragment --><p>Two key builtin build arguments are <code>target_os</code> and <code>target_cpu</code>, which control the OS &amp; CPU of the build.</p>
<p>To see help for all available build arguments:</p>
<div class="fragment"><div class="line">gn gen out/custom</div>
<div class="line">gn args --list out/custom</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md48"></a>
Build Examples</h2>
<p>Examples can be built in two ways, as separate projects that add CHIP in the third_party directory, or in the top level CHIP project.</p>
<p>To build the <code>chip-shell</code> example as a separate project:</p>
<div class="fragment"><div class="line">cd examples/shell</div>
<div class="line">gn gen out/debug</div>
<div class="line">ninja -C out/debug</div>
</div><!-- fragment --><p>To build it at the top level, see below under "Unified Builds".</p>
<h2><a class="anchor" id="autotoc_md49"></a>
Unified Builds</h2>
<p>To build a unified configuration that approximates the set of continuous builds:</p>
<div class="fragment"><div class="line">source scripts/activate.sh</div>
<div class="line"> </div>
<div class="line">gn gen out/unified --args=&#39;is_debug=true target_os=&quot;all&quot;&#39;</div>
<div class="line"> </div>
<div class="line">ninja -C out/unified all</div>
</div><!-- fragment --><p>This can be used prior to change submission to configure, build, and test the gcc, clang, mbedtls, &amp; examples configurations all together in one parallel build. Each configuration has a separate subdirectory in the output dir.</p>
<p>This unified build can be used for day to day development, although it's more expensive to build everything for every edit. To save time, you can name the configuration to build:</p>
<div class="fragment"><div class="line">ninja -C out/unified host_gcc</div>
<div class="line">ninja -C out/unified check_host_gcc</div>
</div><!-- fragment --><p>Replace <code>host_gcc</code> with the name of the configuration, which is found in the root <code>BUILD.gn</code>.</p>
<p>You can also fine tune the configurations generated via arguments such as:</p>
<div class="fragment"><div class="line">gn gen out/unified --args=&#39;is_debug=true target_os=&quot;all&quot; enable_host_clang_build=false&#39;</div>
</div><!-- fragment --><p>For a full list, see the root <code>BUILD.gn</code>.</p>
<p>Note that in the unified build, targets have multiple instances and need to be disambiguated by adding a <code>(toolchain)</code> suffix. Use <code>gn ls out/debug</code> to list all of the target instances. For example:</p>
<div class="fragment"><div class="line">gn desc out/unified &#39;//src/controller(//build/toolchain/host:linux_x64_clang)&#39;</div>
</div><!-- fragment --><p>Note: Some platforms that can be build as part of the unified build require downloading additional SDKs. To add these to the build, the location of the SDK installation must be provided as a build argument. For example, to add the Simplelink cc13x2_26x2 examples to the unified build, install the <a href="https://ti.com/chip_sdk">SDK</a> and add the following build arguments:</p>
<div class="fragment"><div class="line">gn gen out/unified --args=&quot;target_os=\&quot;all\&quot; enable_ti_simplelink_builds=true ti_simplelink_sdk_root=\&quot;/path/to/sdk\&quot; ti_sysconfig_root=\&quot;/path/to/sysconfig\&quot;&quot;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md50"></a>
Getting Help</h2>
<p>GN has builtin help via</p>
<div class="fragment"><div class="line">gn help</div>
</div><!-- fragment --><p>Recommended topics:</p>
<div class="fragment"><div class="line">gn help execution</div>
<div class="line">gn help grammar</div>
<div class="line">gn help toolchain</div>
</div><!-- fragment --><p>Also see the <a href="https://gn.googlesource.com/gn/+/master/docs/quick_start.md">quick start guide</a>.</p>
<h2><a class="anchor" id="autotoc_md51"></a>
Introspection</h2>
<p>GN has various introspection tools to help examine the build configuration.</p>
<p>To show all of the targets in an output directory:</p>
<div class="fragment"><div class="line">gn ls out/host</div>
</div><!-- fragment --><p>To show all of the files that will be built:</p>
<div class="fragment"><div class="line">gn outputs out/host &#39;*&#39;</div>
</div><!-- fragment --><p>To show the GN representation of a configured target:</p>
<div class="fragment"><div class="line">gn desc out/host //src/inet --all</div>
</div><!-- fragment --><p>To dump the GN representation of the entire build as JSON:</p>
<div class="fragment"><div class="line">gn desc out/host/ &#39;*&#39; --all --format=json</div>
</div><!-- fragment --><p>To show the dependency tree:</p>
<div class="fragment"><div class="line">gn desc out/host //:all deps --tree --all</div>
</div><!-- fragment --><p>To find dependency paths:</p>
<div class="fragment"><div class="line">gn path out/host //src/transport/tests:tests //src/system</div>
</div><!-- fragment --><p>To list useful information for linking against libCHIP:</p>
<div class="fragment"><div class="line">gn desc out/host //src/lib include_dirs</div>
<div class="line">gn desc out/host //src/lib defines</div>
<div class="line">gn desc out/host //src/lib outputs</div>
<div class="line"> </div>
<div class="line"># everything as JSON</div>
<div class="line">gn desc out/host //src/lib --format=json</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md52"></a>
Maintaining CHIP</h1>
<p>If you make any change to the GN build system, the next build will regenerate the ninja files automatically. No need to do anything. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Mar 11 2021 17:22:12 for Connected Home over IP by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
